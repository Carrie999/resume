(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.locallyjs=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";(function(){var ls=typeof window!=="undefined"?window.localStorage:null;if(!ls){ls={_data:{},setItem:function setItem(id,val){return this._data[id]=String(val)},getItem:function getItem(id){return this._data.hasOwnProperty(id)?this._data[id]:undefined},removeItem:function removeItem(id){return delete this._data[id]},key:function key(index){for(var key in this_data){if(!index--){return key}}},clear:function clear(){return this._data={}}}}var utils={each:function each(arr,iteratee){var l=arr.length;while(l--)iteratee(arr[l],l)},map:function map(arr,iteratee){var newArr=new Array(arr.length),l=arr.length;while(l--)newArr[l]=iteratee(arr[l],l);return newArr},filter:function filter(arr,iteratee){var newArr=[],l=arr.length;while(l--){if(iteratee(arr[l],l))newArr.push(arr[l])}return newArr}};var _keys,_config,_timeouts={};var Locally=function Locally(options){options=options||{};_config=ls.getItem("locally-config");if(!_config){_config={};_rebuildConfig()}else{try{_config=JSON.parse(_config)}catch(e){if(!!_config){try{_config=JSON.parse(_config)}catch(e){throw new Error("Locally: config is corrupted")}}else throw new Error("Locally: config is corrupted")}_rebuildConfig()}_saveConfig();Object.defineProperty(this,"length",{get:function get(){return _keys.length}})};Locally.prototype.set=function(key,value,options){if(arguments.length<2)throw new Error("Locally: no key or value given");options=options||{};if(typeof options!=="object"){options={ttl:options}}if(typeof options.ttl==="string"){options.ttl=parseInt(options.ttl);if(isNaN(options.ttl)){throw new Error("Locally: ttl should be a number in /light version of Locally.")}}_config[key]=_config[key]||{};if(_keys.indexOf(key)==-1){_keys.push(key)}if(options.ttl&&!isNaN(options.ttl)){_clearTimeout(key);_setTimeout(key,options.ttl)}else if(_config[key].ttl){_clearTimeout(key)}var res=_getType(value);value=res.value;_config[key].t=res.type;key=String(key);value=String(value);ls.setItem(key,value);_saveConfig()};Locally.prototype.get=function(key){return Array.isArray(key)?utils.map(key,function(item){return _get(item)}.bind(this)):_get(key)};Locally.prototype.keys=function(pattern){if(!pattern||pattern=="*")return _keys.slice(0);if(!(pattern instanceof RegExp)){pattern=new RegExp(".*"+pattern+".*")}return utils.filter(_keys,function(key){return pattern.test(key)})};Locally.prototype.remove=function(key){if(typeof key==="undefined")throw new Error("Locally: 'remove' requires a key");if(Array.isArray(key)){utils.each(key,_remove)}else{_remove(key)}};Locally.prototype.scan=function(key,fn){return utils.each(this.keys(key),function(key){fn(_get(key),key)})};Locally.prototype.ttl=function(key){return _config[key]?_config[key].ttl?_config[key].ttl-Date.now():-1:-2};Locally.prototype.persist=function(key){return _config[key]?delete _config[key].ttl&&_saveConfig()&&_clearTimeout(key):false};Locally.prototype.expire=function(key,ttl){return _config[key]?!!(_config[key].ttl=Date.now()+ttl)&&_saveConfig():false};Locally.prototype.clear=function(){ls.clear();_config={};_keys=[];return _saveConfig()};Locally.prototype.key=function(index){return _keys[index]};function _remove(key){var i=_keys.indexOf(key);if(i>-1){ls.removeItem(key);_keys.splice(_keys.indexOf(key),1);delete _config[key]}}function _saveConfig(){ls.setItem("locally-config",JSON.stringify(_config));return true}function _get(key){if(typeof key==="undefined"||!_config[key])return null;if(_config[key].ttl&&_config[key].ttl<Date.now()){delete _config[key];_saveConfig();_remove(key);return null}var temp,value=ls.getItem(key);switch(_config[key].t){case"o":try{value=JSON.parse(value)}catch(e){}return value;break;case"d":return new Date(parseInt(value,10));break;case"r":return new RegExp(value.substring(1,value.length-1));break;case"f":eval("temp = "+value);return temp;break;case"n":return Number(value);break;case"b":return value=="1";break;case"s":default:if(value==="null")return null;else if(value==="undefined")return undefined;else return String(value);break}}function _getType(value){var type;switch(typeof value){case"object":if(value instanceof Date){value=value.getTime();type="d"}else if(value instanceof RegExp){value=value.toString();type="r"}else{value=JSON.stringify(value);type="o"}break;case"function":type="f";break;case"number":type="n";break;case"boolean":value=value?1:0;type="b";break;case"string":default:type="s"}return{value:value,type:type}}function _rebuildConfig(){var l=ls.length;_keys=new Array(l);while(l--){_keys[l]=ls.key(l);_config[_keys[l]]=_config[_keys[l]]||{};ls.setItem(_keys[l],ls.getItem(_keys[l]));if(_config[_keys[l]].ttl){_setTimeout(_keys[l],_config[_keys[l]].ttl-Date.now())}}if(_keys.indexOf("locally-config")>-1){_keys.splice(_keys.indexOf("locally-config"),1)}}function _setTimeout(key,ttl){_config[key].ttl=Date.now()+ttl;_timeouts[key]=setTimeout(function(){_remove(key)},ttl)}function _clearTimeout(key){if(_keys.indexOf(key)>-1){clearTimeout(_timeouts[key]);delete _timeouts[key];delete _config[key].ttl;return true}else return false}if(typeof exports==="object"){module.exports.Store=Locally}if(typeof define==="function"&&define.amd){define(function(){return{Store:Locally}})}if(typeof window==="object"){window.Locally={Store:Locally}}})()},{}]},{},[1])(1)});